# [LCP 14. 切分数组](https://leetcode-cn.com/problems/qie-fen-shu-zu/)

令数组为 $A$, $DP(i)$ 表示考虑到第 $i$ 个后的最小分组数。这样我们有：

$DP(i)=min\{DP(j)+1|j<i,gcd(A_{j+1},A_i)>1\}$

但是直接做复杂度为 $O(n^2)$, 因此需要简化。

---
_第一步_

考虑第 $i$ 个数 $A_i$, 我们可以发现，比起 $A_i$ 本身，我们其实更关注的是 $A_i$ 的质因子们。

举个例子，假如 $A_i=6$，并且在最佳答案中 $A_i$ 与它与前面的一个 $2$ 组成了一组，那么此时我们实际只考虑了 $A_i$ 的质因子 $2$ 这一部分，也就是说，此时将 $A_i$ 替换为 $2$ 也是可以的，而假如当我们考虑到 $A_j=10(i<j)$ 时，此时也可以将 $A_i=6$ 视为 $2$，因为要么我们将 $A_i$ $A_j$ 进行配对，要么就不配对。而在这个选择过程中，$6$ 有 $3$ 这个质因子以及 $10$ 有 $5$ 这个质因子这两个事实，在选择过程中并不提供帮助，因此我们可以简单的将任意输入的数字视作为其质因子的集合。

__总结__

我们将数组 $A$ 中的每一个数，都视作其质因子的集合，比如将 $6$ 视为 $\{2,3\}$。

---
_第二步_

令 $f(p)$ 代表在当前数组末尾来了一个质数 $p$ 之后的最少分组数。（注意：这里只是想象 $p$ 要来，但是实际 $p$ 还没来。)

例如对于数组 $[2,5,3]$ ，我们有 $f(2)=1,f(3)=3,f(5)=2$, 而在插入一个新的数 $6=\{2,3\}$ 后，对于此时的数组 $[2,5,3,6]$ ，我们需要将 $f(p)$ 的 $\{2,3\}$ 部分进行更新，更新后有 $f(2)=1,f(3)=2$, 而 $f(5)=2$ 保持不变。

接下来推导 $f(p)$ 的递推式：

假如我们当前考虑到了 $A_i=\{p_1...p_k\}$, 其中一个质因子为 $p$.

若 $p$ 在前面没有出现过，那么下一次来的 $p$ 只能与 $A_i$ 配对，并且一定会与 $A_i$ 配对，此时
$$f(p)=DP(i-1)+1$$
若 $p$ 在前面出现过，首先根据 $f(p)$ 的定义我们可以用 $f(p)$ 来作为更新 $DP(i)$ 的备选项。

然后我们继续考虑如何更新 $f(p)$, 如果之后来的 $p$ 与 $A_i$ 进行配对的话，那么将 $f(p)$ 更新为 $DP(i-1)+1$，如果来的 $p$ 不与 $A_i$ 进行配对的话，那么相当于这次来的 $A_i$ 其实根本没有质因子 $p$, 那么也就不必去更新 $f(p)$，即
$$f(p)=min\{f(p),DP(i-1)+1\}$$
至此，应该已经可以解题了，但是仍有可以优化的地方。

---
__优化__

由于需要知道每个 $A_i$ 的所有质因子，我们需要一种方法将 $A_i$ 快速因子分解。我们用素数筛提前预处理 $1 \sim 10^6$ 内任意数字 $k$ 的最小质因子 $min\_prime\_factor(k)$。

利用 $min\_prime\_factor(k)$ 获得 $A_i$ 所有质因子的方法为：
1. $x=A_i$
2. 获取 $p=min\_prime\_factor(x)$ 为 $x$ 当前的最小质因子
3. $x = x / p$
4. 如果 $x=1$，结束，否则回到步骤 2

在更新过程中，我们只在乎 $DP(i-1)$ 以及 $DP(i)$, 故可以将 $DP$ 数组压缩为两个变量。